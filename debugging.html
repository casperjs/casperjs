<!DOCTYPE html><html><head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="http://casperjs.org/">
    <title>Debugging | CasperJS 1.0.0-RC4</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <meta name="keywords" content="phantomjs, phantom, casperjs, casper, browser, javascript, navigation, scripting, test, testing, scrape, scraping">
    <meta name="description" content="CasperJS is a browser navigation scripting &amp; testing utility written in Javascript on top of PhantomJS.">
    <meta name="google-site-verification" content="SEcGmVv4IsGYP6-xMJquQcrUrYjIZNXyX0VGfly2m1o">
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Asap:400,700,400italic,700italic&amp;subset=latin,latin-ext">
    <link rel="stylesheet" href="prettify/prettify.css?1353496019024">
    <link rel="stylesheet" href="css/casper.css?1353496019024">
    <link rel="shortcut icon" href="favicon.ico">
</head>
<body>
    <a href="http://github.com/n1k0/casperjs" class="contribute">
        <img src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub">
    </a>
    <div class="navbar navbar-fixed-top" id="topbar">
        <div class="navbar-inner">
            <div class="container">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="./index.html">CasperJS</a>
                <div class="nav-collapse">
                    <ul class="nav">
                        <li><a href="installation.html">Install</a></li>
                        <li><a href="quickstart.html">Quickstart</a></li>
                        <li class="dropdown" id="api-menu">
                            <a class="dropdown-toggle" data-toggle="dropdown" data-target="#api-menu" href="api.html">
                                <abbr title="Application Programming Interface">API</abbr>
                                <b class="caret"></b>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a href="api.html#intro">Home</a></li>
                                <li class="divider"></li>
                                <li><a href="api.html#casper">Casper API</a></li>
                                <li><a href="api.html#client-utils">Client-side utils</a></li>
                                <li><a href="api.html#colorizer">Colorizer API</a></li>
                                <li><a href="api.html#tester">Tester API</a></li>
                                <li><a href="api.html#utils">Utils API</a></li>
                            </ul>
                        </li>
                        <li><a href="cli.html"><abbr title="Command Line Interface">CLI</abbr></a></li>
                        <li><a href="selectors.html">Selectors</a></li>
                        <li><a href="events-filters.html">Events</a></li>
                        <li><a href="logging.html">Logging</a></li>
                        <li><a href="extending.html">Extending</a></li>
                        <li><a href="testing.html">Testing</a></li>
                        <li class="active"><a href="debugging.html">Debugging</a></li>
                        <li><a href="faq.html"><abbr title="Frequently Asked Questions">FAQ</abbr></a></li>
                        <li><a href="https://groups.google.com/forum/#!forum/casperjs">Support</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    <div class="container" id="overview">
        <div class="content"><section>
    <div class="page-header">
        <h1>
            <span class="section-title">Debugging</span>
            
        </h1>
    </div>
    <div class="section-content"><p>First, in all honesty, sometimes debugging CasperJS scripts can be <strong>painful</strong>,
and so for several reasons:

</p>
<ul>
<li>There's <a href="http://code.google.com/p/phantomjs/issues/detail?id=166">no built-in solid stack traces in Exception objects in
PhantomJS</a>,
and that's probably why I, more than often, can't show you something more
helpful than a laconic <em>TypeError: 'undefined' is not a function</em>… The only
stuff we have is a limited emulation of stack traces provided by PhantomJS
using its <code>onError</code> built-in listener, hence those you possibly see when
using CasperJS…</li>
<li>There's <a href="http://code.google.com/p/phantomjs/issues/detail?id=47">no built-in module support in PhantomJS</a>.
The current implementation you're using in CasperJS is somehow a dirty
hack, which combined to the lack of proper support for stack traces and
standard error localization obfuscates a lot script debugging…</li>
<li>Last, Javascript being a wonderful language, it's still very dynamic and
weakly typed… Well, do I really need to say more?&nbsp;;)</li>
</ul>
<p>Despite all these issues, you can eventually manage to get around debugging
using some (all?) of the tricks listed above.

</p>
<h2>Use the verbose mode</h2>
<p>By default &amp; by design, a <code>Casper</code> instance won't print anything to the
console. This can be very limitating &amp; frustrating when creating or debugging
scripts, so a good practice is to always start coding a script using these
settings:

</p>
<pre><code class="javascript">var casper = require('casper').create({
    verbose: true,
    logLevel: "debug"
});</code></pre>
<p>The <code>verbose</code> setting will tell Casper to write every logged message at the
<code>logLevel</code> logging level onto the standard output, so you'll be able to trace
every step made.

</p>
<p><span class="label label-warning">Warning</span> Output will then be pretty
verbose, and will potentially display sensitive informations onto the console.
<strong>Use with care on production.</strong>

</p>
<h2>Hook in the deep using events</h2>
<p><a href="events-filters.html">Events</a> are a very powerful features of CasperJS, and you
should probably give it a look if you haven't already.

</p>
<p>Some interesting events you may eventually use to debug your scripts:

</p>
<ul>
<li>The <code>http.status.XXX</code> event will be emitted everytime a resource is sent with
the <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes">HTTP code</a>
corresponding to <code>XXX</code>;</li>
<li>The <code>remote.alert</code> everytime an <code>alert()</code> call is performed client-side;</li>
<li><code>remote.message</code> everytime a message is sent to the client-side console;</li>
<li><code>step.added</code> everytime a step is added to the stack;</li>
<li>etc…</li>
</ul>
<p>Listening to an event is dead easy:

</p>
<pre><code class="javascript">casper.on('http.status.404', function(resource) {
    this.log('Hey, this one is 404: ' + resource.url, 'warning');
});</code></pre>
<p>Ensure to check the <a href="events-filters.html#events">full list</a> of all the other
available events.

</p>
<h2>Localize yourself in modules</h2>
<p>If you're creating Casper modules, a cool thing to know is that there's a
special built-in variable available in every module, <code>__file__</code>, which contains
the absolute path to current javascript file (the module file).

</p>
<h2>Always, <strong>ALWAYS</strong> name your closures</h2>
<p>Probably one of the most easy but effective best practice, always name your
closures:

</p>
<p><strong>Hard to track:</strong>

</p>
<pre><code class="javascript">casper.start('http://foo.bar/', function() {
    this.evaluate(function() {
        // ...
    });
});</code></pre>
<p><strong>Easier:</strong>

</p>
<pre><code class="javascript">casper.start('http://foo.bar/', function afterStart() {
    this.evaluate(function evaluateStuffAfterStart() {
        // ...
    });
});</code></pre>
<p>That way, everytime one is failing, its name will be printed out in the <em>stack
trace</em>, <strong>so you can more easily locate it within your code</strong>.

</p>
<p>Note that this one also applies for all your other Javascript works, of course
;)
</p>
</div>
</section>
</div>
        <footer>
            <hr>
            <p>
                © 2011-2012 <a href="https://nicolas.perriault.net/">Nicolas Perriault</a> — get
                the source code on GitHub: <a href="http://github.com/n1k0/casperjs">n1k0/casperjs</a> —
                logo by <a href="http://www.forveillejeremy.com/">Jeremy Forveille</a> -
                <a href="https://plus.google.com/106641872690063476159" rel="publisher">Google+</a> -
                <a href="http://flattr.com/thing/586241/CasperJS-a-navigation-scripting-and-testing-utility-for-PhantomJS" class="flattr" target="_blank"><img src="http://api.flattr.com/button/flattr-badge-large.png" alt="Flattr this" title="Flattr this" border="0"></a>
            </p>
        </footer>
    </div>
    <script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js"></script><script src="https://apis.google.com/_/scs/apps-static/_/js/k=oz.gapi.fr.FsXfLREY5Eo.O/m=plusone/am=AQ/rt=j/d=1/rs=AItRSTN7HwNVU5qTAWZQ2ijuTfxtwBN9YQ/cb=gapi.loaded_0" async=""></script><script type="text/javascript" async="" src="http://www.google-analytics.com/ga.js"></script><script type="text/javascript" async="" src="https://apis.google.com/js/plusone.js" gapi_processed="true"></script><script type="text/javascript" src="js/jquery.min.js?1353496019024"></script>
    <script type="text/javascript" src="bootstrap/js/bootstrap.min.js?1353496019024"></script>
    <script type="text/javascript" src="prettify/prettify.js?1353496019024"></script>
    <script type="text/javascript" src="js/application.js?1353496019024"></script>
    <script type="text/javascript">
    (function() {
        var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
        po.src = 'https://apis.google.com/js/plusone.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
    })();
    </script>
    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-71239-7']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>


</body></html>